# 기본 매핑 관계
    
### 주요 개념

- 객체와 테이블 연관관계의 차이
- 객체의 참조와 테이블의 외래키를 매핑

### 키워드
-  방향 : 단방향, 양방향
- 다중성 : 다대일 일대다 일대일 다대다
- 연관관계의 주인


## 연관관계 매핑
* 객체 
    ```
     참조(주소)를 사용. 
     양방향으로 만들순 있지만 정확히는 단방향 관계2개.
    ```
* 테이블
    ```
    외래 키를 사용. 
    양방향 연관 관계.
    ```
* @ManyToOne
    ```
  다대일 관계라는 매핑 정보.
  필수 어노테이션이다.
    ```

* @JoinColumn(name="TEAM_ID")
    ```
    외래 키를 매핑할 때 사용한다.
    name속성
        매핑할 외래 키 이름을 지정.
        기본값 : 필드명 +_+ 참조하는 테이블의 기본 키 컬럼명.
    referenceColumnName 
        외래 키가 참조하는 대상 테이블의 컬럼명.
        참조하는 테이블의 기본키 컬럼명. 
    생략 가능한 어노테이션이다.          
    ```
* 조회
  ```
  연관관계가 있는 엔티티를 조회하는 방법 
     1. 객체 그래프 탐색 (객체의 연관관계를 사용한 조회)
     2. 객체지향 쿼리 사용 (JPQL)
    ```
  
* 삭제
  ```
  연관관계를 먼저 제거하고 삭제해야한다.
  그렇지않으면 외래 키 제약조건으로 인해, 데이터베이스에서 오류발생.
  ```

* 양방향 연관관계
  ```
  서로 다른 단방향 연관관계 2개를 애플리케이션 로직으로 잘 묶어서 양방향인 것 처럼 보이게할 뿐.
  양방향 연관관계로 설정하면 객체의 참조는 둘인데 외래키는 하나다. 둘 사이에 차이가 발생.
  ```
  
* 연관관계의 주인
     ```
     두 객체 연관관계 중 하나를 정해서 테이블의 외래키를 관리하는것.
     연관관계의 주인만이 db 연관관계와 매핑되고 외래키를 관리(등록, 수정, 삭제)할 수 있다.
     주인이 아닌 쪽은 읽기만 할 수 있다. (inverse, non-owning side)
     주인이 아닌 쪽에서만 값을 입력하는 실수를 조심하자.
     객체 관점에서는 양쪽 방향에 모두 값을 입력해주는 것이 가장 안전하다.
     양쪽 다 신경쓰다 실수 할 수 있으니 편의 메소드를 만들어서 하나로 양방향 관계를 모두 설정할 수 있도록 하면 좋다.
  ```

  양방향의 장점은 반대방향으로 객체 그래프 탐색 기능이 추가된것 뿐.

-----------------

강의 note
	
	회원&팀 예제
		객체 연관관계와 테이블의 연관관계 설명..
		테이블 관계에 맞춰서 객체를 모델링
		문제가 있음

		객체 지향 모델링
		단방향 설명. flush(), clear()하면 깔끔하게 다시 가져옴(객체 저장 후)

		양방향 연관관계와 연관관계의 주인
		양방향 객체 연관관계 vs 테이블에서 외래키로 묶은 연관관계
			반대편 사이드에 어떤 변수과 묶여있는지 mappedBy 설정 필요
				mappedBY 란!! 
				객체 연관관계 = 2개(단방향), 테이블 연관관계 = 1개(양방향)
				객체의 양방향 관계는 사실 양방향 관계가 아니라 서로 다른 단방향 관계 2개다
				테이블의 양방향 연관관계는 외래키 하나로 관리한다
				멤버의 팀을 바꿀까? 팀에 멤버스를 바꿀까?
				디비 입장에서는 멤버가 팀ID를 바꾸면 되는 관점이다

				연관관계의 주인
					양방향 매핑 규칙
					객체의 두 관계중 하나를 주인으로 지정
					연관관꼐의 주인만이 외래키를 관리(등록,수정)
					주인이 아닌 쪽은 읽기만 가능
					주인은 mappedBy 속성 사용 x

				db에 들어갈때는 주인의 값만 들어가니까...
				외래키가 있는 주인으로 정해라
				다대일에서 다 쪽을 무조건 주인으로 정해라

		양방향 매핑에서 많이 하는 실수
			양방향 매핑시 연관관계의 주인에 값을 입력해야한다.
			영속성 컨텍스트에 그냥 넣고 가만히 있으면 순수한 객체의 상태이며, 
			항상 양쪽에 값을 매핑하는게 맞다
			jpa내부에서 매커니즘으로 외래키가 있으니 지연로딩을 해야겠다는 판단을 할 수 있다.
			실수 할 수 있으니까 연관관계 편의 멤소드를 생성하자 (이름은 change블라블라 하면 다른 기능이 있다고 추측가능)
			양방향 매핑시에 무한 루프를 조심하자
				toString(), lombok, JSON 생성 라이브러리(무한루프, 컨트롤러에서 엔티티를 반환하면 api 스펙 변경 여지)


		단반향 매핑만으로도 이미 연관관계 매핑은 완료
		양방향 매핑은 반대방향으로 조회기능이 추가된것 뿐
		JPQL에서 역방향으로 탐색할 일이 많음
		단방향 매핑을 잘 하고 양방향은 필요할 때 추가해도 됨(테이블에 영향을 주지않으니까)
		
		
		